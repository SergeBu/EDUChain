{"{\"assumptions\":{},\"sourceRoot\":\"/home/serge/blockchain-lab2/lab3/features/step_definitions/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/home/serge/blockchain-lab2/lab3\",\"filename\":\"/home/serge/blockchain-lab2/lab3/features/step_definitions/educhain_staking_steps.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/serge/blockchain-lab2/lab3\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-explicit-resource-management\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"BlockStatement\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regexp-modifiers\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$3\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$4\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$5\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$6\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$7\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$8\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$9\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$10\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$11\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$12\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"Program\":{\"exit\":[null]},\"_exploded\":true,\"CallExpression\":{\"enter\":[null]},\"ImportExpression\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$16\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"/home/serge/blockchain-lab2/node_modules/@babel/preset-env/lib/index.js$17\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.28.0:development":{"value":{"code":"\"use strict\";\n\nconst {\n  Given,\n  When,\n  Then,\n  Before\n} = require('@cucumber/cucumber');\nconst {\n  expect\n} = require('chai');\nconst {\n  ethers\n} = require(\"ethers\");\nconst fs = require('fs');\nconst path = require('path');\n\n// Глобальный объект для отслеживания nonce\nconst nonceManager = {};\nBefore(async function () {\n  // Инициализация провайдера\n  this.provider = new ethers.JsonRpcProvider(\"http://localhost:8545\");\n\n  // Получаем аккаунты\n  this.accounts = await this.provider.listAccounts();\n\n  // Приватные ключи для Anvil\n  const privateKeys = [\"0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80\",\n  // admin\n  \"0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d\",\n  // alice\n  \"0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a\",\n  // bob\n  \"0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6\",\n  // carol\n  \"0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a\" // dave\n  ];\n  this.signers = [];\n  for (let i = 0; i < privateKeys.length; i++) {\n    const wallet = new ethers.Wallet(privateKeys[i], this.provider);\n    this.signers.push(wallet);\n\n    // Инициализируем nonce для каждого аккаунта\n    nonceManager[wallet.address] = await this.provider.getTransactionCount(wallet.address, 'latest');\n  }\n\n  // Сохраняем пользователей по именам\n  this.admin = this.signers[0];\n  this.alice = this.signers[1];\n  this.bob = this.signers[2];\n  this.carol = this.signers[3];\n  this.dave = this.signers[4];\n\n  // Сброс состояния\n  this.contract = null;\n  this.lastTx = null;\n  this.lastError = null;\n});\nBefore({\n  tags: \"@requires_contract\"\n}, async function () {\n  const artifactPath = path.join(process.cwd(), 'out', 'EDUToken.sol', 'EDUToken.json');\n  const artifact = JSON.parse(fs.readFileSync(artifactPath, 'utf8'));\n  const bytecode = artifact.bytecode.object || artifact.bytecode;\n\n  // Используем nonceManager для админа\n  const nonce = nonceManager[this.admin.address];\n  const tx = await this.admin.sendTransaction({\n    data: bytecode,\n    gasLimit: 10_000_000,\n    nonce\n  });\n  const receipt = await tx.wait();\n  this.contractAddress = receipt.contractAddress;\n  nonceManager[this.admin.address]++; // Увеличиваем nonce\n\n  this.contract = new ethers.Contract(this.contractAddress, artifact.abi, this.admin);\n\n  // Инициализация хешей ролей\n  this.STUDENT_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"STUDENT_ROLE\"));\n  this.PROFESSOR_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"PROFESSOR_ROLE\"));\n  this.ADMIN_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"DEFAULT_ADMIN_ROLE\"));\n  this.INVESTOR_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"INVESTOR_ROLE\"));\n});\n\n// Общий метод для отправки транзакций с управлением nonce\nasync function sendTransaction(signer, contract, methodName, args) {\n  const address = signer.address;\n  const nonce = nonceManager[address];\n  let tx;\n  if (contract) {\n    tx = await contract.connect(signer)[methodName](...args, {\n      nonce\n    });\n  } else {\n    // Для простых транзакций (например, развертывание)\n    tx = await signer.sendTransaction({\n      ...args,\n      nonce\n    });\n  }\n  await tx.wait();\n  nonceManager[address]++; // Увеличиваем nonce после успешной транзакции\n  return tx;\n}\nGiven('Контракт не находится в состоянии паузы', async function () {\n  expect(await this.contract.paused()).to.be.false;\n});\nGiven('Пользователь {string} имеет роль {string}', async function (userName, roleName) {\n  const user = this[userName.toLowerCase()];\n  let role;\n  switch (roleName) {\n    case 'Student':\n      role = this.STUDENT_ROLE;\n      break;\n    case 'Professor':\n      role = this.PROFESSOR_ROLE;\n      break;\n    case 'Admin':\n      role = this.ADMIN_ROLE;\n      break;\n    case 'Investor':\n      role = this.INVESTOR_ROLE;\n      break;\n    default:\n      throw new Error(`Unknown role: ${roleName}`);\n  }\n  await sendTransaction(this.admin, this.contract, 'grantRole', [role, user.address]);\n});\n\n// Обновить шаги, связанные с балансом\nGiven('Кошелек {string} имеет баланс ≥ {int} EDU', async function (userName, minBalance) {\n  const user = this[userName.toLowerCase()];\n  const minBalanceWei = ethers.parseEther(String(minBalance));\n  const amount = minBalanceWei + ethers.parseEther(\"1\");\n  await sendTransaction(this.admin, this.contract, 'mint', [user.address, amount]);\n  const userBalance = await this.contract.balanceOf(user.address);\n  expect(userBalance >= minBalanceWei).to.be.true;\n});\nGiven('Администратор приостановил контракт', async function () {\n  await sendTransaction(this.admin, this.contract, 'setPaused', [true]);\n  expect(await this.contract.paused()).to.be.true;\n});\n\n// В шаге When добавить сброс ошибки\nWhen('Пользователь {string} вызывает метод stake\\\\({int})', async function (userName, amount) {\n  const user = this[userName.toLowerCase()];\n  this.lastError = null; // Сбрасываем ошибку\n  const amountWei = ethers.parseEther(amount.toString());\n  try {\n    this.lastTx = await sendTransaction(user, this.contract, 'stake', [amountWei]);\n  } catch (error) {\n    this.lastError = error;\n  }\n});\nThen('Баланс стейкинга {string} увеличивается на {int} EDU', async function (userName, amount) {\n  const user = this[userName.toLowerCase()];\n  const stakeBalance = await this.contract.getStake(user.address);\n  const amountWei = ethers.parseEther(amount.toString());\n  expect(stakeBalance).to.equal(amountWei);\n});\nThen('Баланс стейкинга {string} не изменяется', async function (userName) {\n  const user = this[userName.toLowerCase()];\n  const stakeBalance = await this.contract.getStake(user.address);\n  expect(stakeBalance).to.equal(0n); // Используем BigInt литерал 0n\n});\nThen('Событие Staked эмитируется с параметрами \\\\({string}, {int})', async function (userName, amount) {\n  const user = this[userName.toLowerCase()];\n  const amountWei = ethers.parseEther(amount.toString());\n  const receipt = await this.lastTx.wait();\n  let eventFound = false;\n  for (const log of receipt.logs) {\n    try {\n      const event = this.contract.interface.parseLog(log);\n      if (event.name === \"Staked\" && event.args.user === user.address && event.args.amount == amountWei) {\n        eventFound = true;\n        break;\n      }\n    } catch (e) {\n      // Игнорируем нерелевантные логи\n    }\n  }\n  if (!eventFound) {\n    throw new Error(`Event Staked with parameters (${userName}, ${amount}) not found`);\n  }\n});\nGiven('Контракт активен', async function () {\n  const isPaused = await this.contract.paused();\n  if (isPaused) {\n    await sendTransaction(this.admin, this.contract, 'setPaused', [false]);\n  }\n  expect(await this.contract.paused()).to.be.false;\n});\nThen('Транзакция отменена с ошибкой {string}', function (errorMessage) {\n  expect(this.lastError).to.not.be.undefined;\n\n  // Проверяем разные форматы ошибок\n  const actualError = this.lastError.message.toLowerCase();\n  const expectedError = errorMessage.toLowerCase();\n  if (!actualError.includes(expectedError)) {\n    throw new Error(`Expected error \"${errorMessage}\" but got \"${this.lastError.message}\"`);\n  }\n});\n// Исправленные шаги\nThen('успешно', function () {\n  expect(this.lastError).to.be.oneOf([null, undefined]);\n});\nThen('ошибка', function () {\n  expect(this.lastError).to.not.be.oneOf([null, undefined]);\n});\n\n// Обновить шаг проверки сообщения об ошибке\nThen('сообщение об ошибке содержит {string}', function (errorMessage) {\n  if (errorMessage === '') {\n    // Для пустого сообщения - ошибки не должно быть\n    expect(this.lastError).to.be.oneOf([null, undefined]);\n  } else {\n    // Для непустого сообщения - должна быть ошибка\n    expect(this.lastError).to.not.be.oneOf([null, undefined]);\n    expect(this.lastError.message).to.include(errorMessage);\n  }\n});\n\n// Добавить этот шаг обратно\nThen('Событие Staked эмитируется с параметрами \\\\(alice, {int})', async function (amount) {\n  const amountWei = ethers.parseEther(amount.toString());\n  const receipt = await this.lastTx.wait();\n  let eventFound = false;\n  for (const log of receipt.logs) {\n    try {\n      const event = this.contract.interface.parseLog(log);\n      if (event.name === \"Staked\" && event.args.user === this.alice.address && event.args.amount == amountWei) {\n        eventFound = true;\n        break;\n      }\n    } catch (e) {\n      // Игнорируем нерелевантные логи\n    }\n  }\n  if (!eventFound) {\n    throw new Error(`Event Staked with parameters (alice, ${amount}) not found`);\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHaXZlbiIsIldoZW4iLCJUaGVuIiwiQmVmb3JlIiwicmVxdWlyZSIsImV4cGVjdCIsImV0aGVycyIsImZzIiwicGF0aCIsIm5vbmNlTWFuYWdlciIsInByb3ZpZGVyIiwiSnNvblJwY1Byb3ZpZGVyIiwiYWNjb3VudHMiLCJsaXN0QWNjb3VudHMiLCJwcml2YXRlS2V5cyIsInNpZ25lcnMiLCJpIiwibGVuZ3RoIiwid2FsbGV0IiwiV2FsbGV0IiwicHVzaCIsImFkZHJlc3MiLCJnZXRUcmFuc2FjdGlvbkNvdW50IiwiYWRtaW4iLCJhbGljZSIsImJvYiIsImNhcm9sIiwiZGF2ZSIsImNvbnRyYWN0IiwibGFzdFR4IiwibGFzdEVycm9yIiwidGFncyIsImFydGlmYWN0UGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiYXJ0aWZhY3QiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJieXRlY29kZSIsIm9iamVjdCIsIm5vbmNlIiwidHgiLCJzZW5kVHJhbnNhY3Rpb24iLCJkYXRhIiwiZ2FzTGltaXQiLCJyZWNlaXB0Iiwid2FpdCIsImNvbnRyYWN0QWRkcmVzcyIsIkNvbnRyYWN0IiwiYWJpIiwiU1RVREVOVF9ST0xFIiwia2VjY2FrMjU2IiwidG9VdGY4Qnl0ZXMiLCJQUk9GRVNTT1JfUk9MRSIsIkFETUlOX1JPTEUiLCJJTlZFU1RPUl9ST0xFIiwic2lnbmVyIiwibWV0aG9kTmFtZSIsImFyZ3MiLCJjb25uZWN0IiwicGF1c2VkIiwidG8iLCJiZSIsImZhbHNlIiwidXNlck5hbWUiLCJyb2xlTmFtZSIsInVzZXIiLCJ0b0xvd2VyQ2FzZSIsInJvbGUiLCJFcnJvciIsIm1pbkJhbGFuY2UiLCJtaW5CYWxhbmNlV2VpIiwicGFyc2VFdGhlciIsIlN0cmluZyIsImFtb3VudCIsInVzZXJCYWxhbmNlIiwiYmFsYW5jZU9mIiwidHJ1ZSIsImFtb3VudFdlaSIsInRvU3RyaW5nIiwiZXJyb3IiLCJzdGFrZUJhbGFuY2UiLCJnZXRTdGFrZSIsImVxdWFsIiwiZXZlbnRGb3VuZCIsImxvZyIsImxvZ3MiLCJldmVudCIsImludGVyZmFjZSIsInBhcnNlTG9nIiwibmFtZSIsImUiLCJpc1BhdXNlZCIsImVycm9yTWVzc2FnZSIsIm5vdCIsInVuZGVmaW5lZCIsImFjdHVhbEVycm9yIiwibWVzc2FnZSIsImV4cGVjdGVkRXJyb3IiLCJpbmNsdWRlcyIsIm9uZU9mIiwiaW5jbHVkZSJdLCJzb3VyY2VSb290IjoiL2hvbWUvc2VyZ2UvYmxvY2tjaGFpbi1sYWIyL2xhYjMvZmVhdHVyZXMvc3RlcF9kZWZpbml0aW9ucy8iLCJzb3VyY2VzIjpbImVkdWNoYWluX3N0YWtpbmdfc3RlcHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBHaXZlbiwgV2hlbiwgVGhlbiwgQmVmb3JlIH0gPSByZXF1aXJlKCdAY3VjdW1iZXIvY3VjdW1iZXInKTtcclxuY29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTtcclxuY29uc3QgeyBldGhlcnMgfSA9IHJlcXVpcmUoXCJldGhlcnNcIik7XHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuXHJcbi8vINCT0LvQvtCx0LDQu9GM0L3Ri9C5INC+0LHRitC10LrRgiDQtNC70Y8g0L7RgtGB0LvQtdC20LjQstCw0L3QuNGPIG5vbmNlXHJcbmNvbnN0IG5vbmNlTWFuYWdlciA9IHt9O1xyXG5cclxuQmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICAvLyDQmNC90LjRhtC40LDQu9C40LfQsNGG0LjRjyDQv9GA0L7QstCw0LnQtNC10YDQsFxyXG4gIHRoaXMucHJvdmlkZXIgPSBuZXcgZXRoZXJzLkpzb25ScGNQcm92aWRlcihcImh0dHA6Ly9sb2NhbGhvc3Q6ODU0NVwiKTtcclxuICBcclxuICAvLyDQn9C+0LvRg9GH0LDQtdC8INCw0LrQutCw0YPQvdGC0YtcclxuICB0aGlzLmFjY291bnRzID0gYXdhaXQgdGhpcy5wcm92aWRlci5saXN0QWNjb3VudHMoKTtcclxuICBcclxuICAvLyDQn9GA0LjQstCw0YLQvdGL0LUg0LrQu9GO0YfQuCDQtNC70Y8gQW52aWxcclxuICBjb25zdCBwcml2YXRlS2V5cyA9IFtcclxuICAgIFwiMHhhYzA5NzRiZWMzOWExN2UzNmJhNGE2YjRkMjM4ZmY5NDRiYWNiNDc4Y2JlZDVlZmNhZTc4NGQ3YmY0ZjJmZjgwXCIsIC8vIGFkbWluXHJcbiAgICBcIjB4NTljNjk5NWU5OThmOTdhNWEwMDQ0OTY2ZjA5NDUzODlkYzllODZkYWU4OGM3YTg0MTJmNDYwM2I2Yjc4NjkwZFwiLCAvLyBhbGljZVxyXG4gICAgXCIweDVkZTQxMTFhZmExYTRiOTQ5MDhmODMxMDNlYjFmMTcwNjM2N2MyZTY4Y2E4NzBmYzNmYjlhODA0Y2RhYjM2NWFcIiwgLy8gYm9iXHJcbiAgICBcIjB4N2M4NTIxMTgyOTRlNTFlNjUzNzEyYTgxZTA1ODAwZjQxOTE0MTc1MWJlNThmNjA1YzM3MWUxNTE0MWIwMDdhNlwiLCAvLyBjYXJvbFxyXG4gICAgXCIweDQ3ZTE3OWVjMTk3NDg4NTkzYjE4N2Y4MGEwMGViMGRhOTFmMWI5ZDBiMTNmODczMzYzOWYxOWMzMGEzNDkyNmFcIiAgLy8gZGF2ZVxyXG4gIF07XHJcbiAgXHJcbiAgdGhpcy5zaWduZXJzID0gW107XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcml2YXRlS2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3Qgd2FsbGV0ID0gbmV3IGV0aGVycy5XYWxsZXQocHJpdmF0ZUtleXNbaV0sIHRoaXMucHJvdmlkZXIpO1xyXG4gICAgdGhpcy5zaWduZXJzLnB1c2god2FsbGV0KTtcclxuICAgIFxyXG4gICAgLy8g0JjQvdC40YbQuNCw0LvQuNC30LjRgNGD0LXQvCBub25jZSDQtNC70Y8g0LrQsNC20LTQvtCz0L4g0LDQutC60LDRg9C90YLQsFxyXG4gICAgbm9uY2VNYW5hZ2VyW3dhbGxldC5hZGRyZXNzXSA9IGF3YWl0IHRoaXMucHJvdmlkZXIuZ2V0VHJhbnNhY3Rpb25Db3VudCh3YWxsZXQuYWRkcmVzcywgJ2xhdGVzdCcpO1xyXG4gIH1cclxuICBcclxuICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10Lkg0L/QviDQuNC80LXQvdCw0LxcclxuICB0aGlzLmFkbWluID0gdGhpcy5zaWduZXJzWzBdO1xyXG4gIHRoaXMuYWxpY2UgPSB0aGlzLnNpZ25lcnNbMV07XHJcbiAgdGhpcy5ib2IgPSB0aGlzLnNpZ25lcnNbMl07XHJcbiAgdGhpcy5jYXJvbCA9IHRoaXMuc2lnbmVyc1szXTtcclxuICB0aGlzLmRhdmUgPSB0aGlzLnNpZ25lcnNbNF07XHJcbiAgXHJcbiAgLy8g0KHQsdGA0L7RgSDRgdC+0YHRgtC+0Y/QvdC40Y9cclxuICB0aGlzLmNvbnRyYWN0ID0gbnVsbDtcclxuICB0aGlzLmxhc3RUeCA9IG51bGw7XHJcbiAgdGhpcy5sYXN0RXJyb3IgPSBudWxsO1xyXG59KTtcclxuXHJcbkJlZm9yZSh7IHRhZ3M6IFwiQHJlcXVpcmVzX2NvbnRyYWN0XCIgfSwgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IGFydGlmYWN0UGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnb3V0JywgJ0VEVVRva2VuLnNvbCcsICdFRFVUb2tlbi5qc29uJyk7XHJcbiAgY29uc3QgYXJ0aWZhY3QgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhhcnRpZmFjdFBhdGgsICd1dGY4JykpO1xyXG4gIGNvbnN0IGJ5dGVjb2RlID0gYXJ0aWZhY3QuYnl0ZWNvZGUub2JqZWN0IHx8IGFydGlmYWN0LmJ5dGVjb2RlO1xyXG4gIFxyXG4gIC8vINCY0YHQv9C+0LvRjNC30YPQtdC8IG5vbmNlTWFuYWdlciDQtNC70Y8g0LDQtNC80LjQvdCwXHJcbiAgY29uc3Qgbm9uY2UgPSBub25jZU1hbmFnZXJbdGhpcy5hZG1pbi5hZGRyZXNzXTtcclxuICBcclxuICBjb25zdCB0eCA9IGF3YWl0IHRoaXMuYWRtaW4uc2VuZFRyYW5zYWN0aW9uKHtcclxuICAgIGRhdGE6IGJ5dGVjb2RlLFxyXG4gICAgZ2FzTGltaXQ6IDEwXzAwMF8wMDAsXHJcbiAgICBub25jZVxyXG4gIH0pO1xyXG4gIFxyXG4gIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0eC53YWl0KCk7XHJcbiAgdGhpcy5jb250cmFjdEFkZHJlc3MgPSByZWNlaXB0LmNvbnRyYWN0QWRkcmVzcztcclxuICBub25jZU1hbmFnZXJbdGhpcy5hZG1pbi5hZGRyZXNzXSsrOyAvLyDQo9Cy0LXQu9C40YfQuNCy0LDQtdC8IG5vbmNlXHJcbiAgXHJcbiAgdGhpcy5jb250cmFjdCA9IG5ldyBldGhlcnMuQ29udHJhY3QoXHJcbiAgICB0aGlzLmNvbnRyYWN0QWRkcmVzcyxcclxuICAgIGFydGlmYWN0LmFiaSxcclxuICAgIHRoaXMuYWRtaW5cclxuICApO1xyXG4gIFxyXG4gIC8vINCY0L3QuNGG0LjQsNC70LjQt9Cw0YbQuNGPINGF0LXRiNC10Lkg0YDQvtC70LXQuVxyXG4gIHRoaXMuU1RVREVOVF9ST0xFID0gZXRoZXJzLmtlY2NhazI1NihldGhlcnMudG9VdGY4Qnl0ZXMoXCJTVFVERU5UX1JPTEVcIikpO1xyXG4gIHRoaXMuUFJPRkVTU09SX1JPTEUgPSBldGhlcnMua2VjY2FrMjU2KGV0aGVycy50b1V0ZjhCeXRlcyhcIlBST0ZFU1NPUl9ST0xFXCIpKTtcclxuICB0aGlzLkFETUlOX1JPTEUgPSBldGhlcnMua2VjY2FrMjU2KGV0aGVycy50b1V0ZjhCeXRlcyhcIkRFRkFVTFRfQURNSU5fUk9MRVwiKSk7XHJcbiAgdGhpcy5JTlZFU1RPUl9ST0xFID0gZXRoZXJzLmtlY2NhazI1NihldGhlcnMudG9VdGY4Qnl0ZXMoXCJJTlZFU1RPUl9ST0xFXCIpKTtcclxufSk7XHJcblxyXG4vLyDQntCx0YnQuNC5INC80LXRgtC+0LQg0LTQu9GPINC+0YLQv9GA0LDQstC60Lgg0YLRgNCw0L3Qt9Cw0LrRhtC40Lkg0YEg0YPQv9GA0LDQstC70LXQvdC40LXQvCBub25jZVxyXG5hc3luYyBmdW5jdGlvbiBzZW5kVHJhbnNhY3Rpb24oc2lnbmVyLCBjb250cmFjdCwgbWV0aG9kTmFtZSwgYXJncykge1xyXG4gIGNvbnN0IGFkZHJlc3MgPSBzaWduZXIuYWRkcmVzcztcclxuICBjb25zdCBub25jZSA9IG5vbmNlTWFuYWdlclthZGRyZXNzXTtcclxuICBcclxuICBsZXQgdHg7XHJcbiAgaWYgKGNvbnRyYWN0KSB7XHJcbiAgICB0eCA9IGF3YWl0IGNvbnRyYWN0LmNvbm5lY3Qoc2lnbmVyKVttZXRob2ROYW1lXSguLi5hcmdzLCB7IG5vbmNlIH0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyDQlNC70Y8g0L/RgNC+0YHRgtGL0YUg0YLRgNCw0L3Qt9Cw0LrRhtC40LkgKNC90LDQv9GA0LjQvNC10YAsINGA0LDQt9Cy0LXRgNGC0YvQstCw0L3QuNC1KVxyXG4gICAgdHggPSBhd2FpdCBzaWduZXIuc2VuZFRyYW5zYWN0aW9uKHsgLi4uYXJncywgbm9uY2UgfSk7XHJcbiAgfVxyXG4gIFxyXG4gIGF3YWl0IHR4LndhaXQoKTtcclxuICBub25jZU1hbmFnZXJbYWRkcmVzc10rKzsgLy8g0KPQstC10LvQuNGH0LjQstCw0LXQvCBub25jZSDQv9C+0YHQu9C1INGD0YHQv9C10YjQvdC+0Lkg0YLRgNCw0L3Qt9Cw0LrRhtC40LhcclxuICByZXR1cm4gdHg7XHJcbn1cclxuXHJcbkdpdmVuKCfQmtC+0L3RgtGA0LDQutGCINC90LUg0L3QsNGF0L7QtNC40YLRgdGPINCyINGB0L7RgdGC0L7Rj9C90LjQuCDQv9Cw0YPQt9GLJywgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGV4cGVjdChhd2FpdCB0aGlzLmNvbnRyYWN0LnBhdXNlZCgpKS50by5iZS5mYWxzZTtcclxufSk7XHJcblxyXG5HaXZlbign0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMIHtzdHJpbmd9INC40LzQtdC10YIg0YDQvtC70Ywge3N0cmluZ30nLCBhc3luYyBmdW5jdGlvbiAodXNlck5hbWUsIHJvbGVOYW1lKSB7XHJcbiAgY29uc3QgdXNlciA9IHRoaXNbdXNlck5hbWUudG9Mb3dlckNhc2UoKV07XHJcbiAgbGV0IHJvbGU7XHJcbiAgXHJcbiAgc3dpdGNoKHJvbGVOYW1lKSB7XHJcbiAgICBjYXNlICdTdHVkZW50Jzogcm9sZSA9IHRoaXMuU1RVREVOVF9ST0xFOyBicmVhaztcclxuICAgIGNhc2UgJ1Byb2Zlc3Nvcic6IHJvbGUgPSB0aGlzLlBST0ZFU1NPUl9ST0xFOyBicmVhaztcclxuICAgIGNhc2UgJ0FkbWluJzogcm9sZSA9IHRoaXMuQURNSU5fUk9MRTsgYnJlYWs7XHJcbiAgICBjYXNlICdJbnZlc3Rvcic6IHJvbGUgPSB0aGlzLklOVkVTVE9SX1JPTEU7IGJyZWFrO1xyXG4gICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHJvbGU6ICR7cm9sZU5hbWV9YCk7XHJcbiAgfVxyXG4gIFxyXG4gIGF3YWl0IHNlbmRUcmFuc2FjdGlvbihcclxuICAgIHRoaXMuYWRtaW4sXHJcbiAgICB0aGlzLmNvbnRyYWN0LFxyXG4gICAgJ2dyYW50Um9sZScsXHJcbiAgICBbcm9sZSwgdXNlci5hZGRyZXNzXVxyXG4gICk7XHJcbn0pO1xyXG5cclxuLy8g0J7QsdC90L7QstC40YLRjCDRiNCw0LPQuCwg0YHQstGP0LfQsNC90L3Ri9C1INGBINCx0LDQu9Cw0L3RgdC+0LxcclxuR2l2ZW4oJ9Ca0L7RiNC10LvQtdC6IHtzdHJpbmd9INC40LzQtdC10YIg0LHQsNC70LDQvdGBIOKJpSB7aW50fSBFRFUnLCBhc3luYyBmdW5jdGlvbiAodXNlck5hbWUsIG1pbkJhbGFuY2UpIHtcclxuICBjb25zdCB1c2VyID0gdGhpc1t1c2VyTmFtZS50b0xvd2VyQ2FzZSgpXTtcclxuICBjb25zdCBtaW5CYWxhbmNlV2VpID0gZXRoZXJzLnBhcnNlRXRoZXIoU3RyaW5nKG1pbkJhbGFuY2UpKTtcclxuICBjb25zdCBhbW91bnQgPSBtaW5CYWxhbmNlV2VpICsgZXRoZXJzLnBhcnNlRXRoZXIoXCIxXCIpO1xyXG4gIFxyXG4gIGF3YWl0IHNlbmRUcmFuc2FjdGlvbihcclxuICAgIHRoaXMuYWRtaW4sXHJcbiAgICB0aGlzLmNvbnRyYWN0LFxyXG4gICAgJ21pbnQnLFxyXG4gICAgW3VzZXIuYWRkcmVzcywgYW1vdW50XVxyXG4gICk7XHJcbiAgXHJcbiAgY29uc3QgdXNlckJhbGFuY2UgPSBhd2FpdCB0aGlzLmNvbnRyYWN0LmJhbGFuY2VPZih1c2VyLmFkZHJlc3MpO1xyXG4gIGV4cGVjdCh1c2VyQmFsYW5jZSA+PSBtaW5CYWxhbmNlV2VpKS50by5iZS50cnVlO1xyXG59KTtcclxuXHJcbkdpdmVuKCfQkNC00LzQuNC90LjRgdGC0YDQsNGC0L7RgCDQv9GA0LjQvtGB0YLQsNC90L7QstC40Lsg0LrQvtC90YLRgNCw0LrRgicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICBhd2FpdCBzZW5kVHJhbnNhY3Rpb24oXHJcbiAgICB0aGlzLmFkbWluLFxyXG4gICAgdGhpcy5jb250cmFjdCxcclxuICAgICdzZXRQYXVzZWQnLFxyXG4gICAgW3RydWVdXHJcbiAgKTtcclxuICBleHBlY3QoYXdhaXQgdGhpcy5jb250cmFjdC5wYXVzZWQoKSkudG8uYmUudHJ1ZTtcclxufSk7XHJcblxyXG4vLyDQkiDRiNCw0LPQtSBXaGVuINC00L7QsdCw0LLQuNGC0Ywg0YHQsdGA0L7RgSDQvtGI0LjQsdC60LhcclxuV2hlbign0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMIHtzdHJpbmd9INCy0YvQt9GL0LLQsNC10YIg0LzQtdGC0L7QtCBzdGFrZVxcXFwoe2ludH0pJywgYXN5bmMgZnVuY3Rpb24gKHVzZXJOYW1lLCBhbW91bnQpIHtcclxuICBjb25zdCB1c2VyID0gdGhpc1t1c2VyTmFtZS50b0xvd2VyQ2FzZSgpXTtcclxuICB0aGlzLmxhc3RFcnJvciA9IG51bGw7IC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INC+0YjQuNCx0LrRg1xyXG4gIGNvbnN0IGFtb3VudFdlaSA9IGV0aGVycy5wYXJzZUV0aGVyKGFtb3VudC50b1N0cmluZygpKTtcclxuICBcclxuICB0cnkge1xyXG4gICAgdGhpcy5sYXN0VHggPSBhd2FpdCBzZW5kVHJhbnNhY3Rpb24oXHJcbiAgICAgIHVzZXIsXHJcbiAgICAgIHRoaXMuY29udHJhY3QsXHJcbiAgICAgICdzdGFrZScsXHJcbiAgICAgIFthbW91bnRXZWldXHJcbiAgICApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICB0aGlzLmxhc3RFcnJvciA9IGVycm9yO1xyXG4gIH1cclxufSk7XHJcblxyXG5UaGVuKCfQkdCw0LvQsNC90YEg0YHRgtC10LnQutC40L3Qs9CwIHtzdHJpbmd9INGD0LLQtdC70LjRh9C40LLQsNC10YLRgdGPINC90LAge2ludH0gRURVJywgYXN5bmMgZnVuY3Rpb24gKHVzZXJOYW1lLCBhbW91bnQpIHtcclxuICBjb25zdCB1c2VyID0gdGhpc1t1c2VyTmFtZS50b0xvd2VyQ2FzZSgpXTtcclxuICBjb25zdCBzdGFrZUJhbGFuY2UgPSBhd2FpdCB0aGlzLmNvbnRyYWN0LmdldFN0YWtlKHVzZXIuYWRkcmVzcyk7XHJcbiAgY29uc3QgYW1vdW50V2VpID0gZXRoZXJzLnBhcnNlRXRoZXIoYW1vdW50LnRvU3RyaW5nKCkpO1xyXG4gIGV4cGVjdChzdGFrZUJhbGFuY2UpLnRvLmVxdWFsKGFtb3VudFdlaSk7XHJcbn0pO1xyXG5cclxuVGhlbign0JHQsNC70LDQvdGBINGB0YLQtdC50LrQuNC90LPQsCB7c3RyaW5nfSDQvdC1INC40LfQvNC10L3Rj9C10YLRgdGPJywgYXN5bmMgZnVuY3Rpb24gKHVzZXJOYW1lKSB7XHJcbiAgY29uc3QgdXNlciA9IHRoaXNbdXNlck5hbWUudG9Mb3dlckNhc2UoKV07XHJcbiAgY29uc3Qgc3Rha2VCYWxhbmNlID0gYXdhaXQgdGhpcy5jb250cmFjdC5nZXRTdGFrZSh1c2VyLmFkZHJlc3MpO1xyXG4gIGV4cGVjdChzdGFrZUJhbGFuY2UpLnRvLmVxdWFsKDBuKTsgLy8g0JjRgdC/0L7Qu9GM0LfRg9C10LwgQmlnSW50INC70LjRgtC10YDQsNC7IDBuXHJcbn0pO1xyXG5cclxuVGhlbign0KHQvtCx0YvRgtC40LUgU3Rha2VkINGN0LzQuNGC0LjRgNGD0LXRgtGB0Y8g0YEg0L/QsNGA0LDQvNC10YLRgNCw0LzQuCBcXFxcKHtzdHJpbmd9LCB7aW50fSknLCBhc3luYyBmdW5jdGlvbiAodXNlck5hbWUsIGFtb3VudCkge1xyXG4gIGNvbnN0IHVzZXIgPSB0aGlzW3VzZXJOYW1lLnRvTG93ZXJDYXNlKCldO1xyXG4gIGNvbnN0IGFtb3VudFdlaSA9IGV0aGVycy5wYXJzZUV0aGVyKGFtb3VudC50b1N0cmluZygpKTtcclxuICBjb25zdCByZWNlaXB0ID0gYXdhaXQgdGhpcy5sYXN0VHgud2FpdCgpO1xyXG4gIFxyXG4gIGxldCBldmVudEZvdW5kID0gZmFsc2U7XHJcbiAgZm9yIChjb25zdCBsb2cgb2YgcmVjZWlwdC5sb2dzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBldmVudCA9IHRoaXMuY29udHJhY3QuaW50ZXJmYWNlLnBhcnNlTG9nKGxvZyk7XHJcbiAgICAgIGlmIChldmVudC5uYW1lID09PSBcIlN0YWtlZFwiICYmIFxyXG4gICAgICAgICAgZXZlbnQuYXJncy51c2VyID09PSB1c2VyLmFkZHJlc3MgJiYgXHJcbiAgICAgICAgICBldmVudC5hcmdzLmFtb3VudCA9PSBhbW91bnRXZWkpIHtcclxuICAgICAgICBldmVudEZvdW5kID0gdHJ1ZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAvLyDQmNCz0L3QvtGA0LjRgNGD0LXQvCDQvdC10YDQtdC70LXQstCw0L3RgtC90YvQtSDQu9C+0LPQuFxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBpZiAoIWV2ZW50Rm91bmQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihgRXZlbnQgU3Rha2VkIHdpdGggcGFyYW1ldGVycyAoJHt1c2VyTmFtZX0sICR7YW1vdW50fSkgbm90IGZvdW5kYCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbkdpdmVuKCfQmtC+0L3RgtGA0LDQutGCINCw0LrRgtC40LLQtdC9JywgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IGlzUGF1c2VkID0gYXdhaXQgdGhpcy5jb250cmFjdC5wYXVzZWQoKTtcclxuICBcclxuICBpZiAoaXNQYXVzZWQpIHtcclxuICAgIGF3YWl0IHNlbmRUcmFuc2FjdGlvbihcclxuICAgICAgdGhpcy5hZG1pbixcclxuICAgICAgdGhpcy5jb250cmFjdCxcclxuICAgICAgJ3NldFBhdXNlZCcsXHJcbiAgICAgIFtmYWxzZV1cclxuICAgICk7XHJcbiAgfVxyXG4gIFxyXG4gIGV4cGVjdChhd2FpdCB0aGlzLmNvbnRyYWN0LnBhdXNlZCgpKS50by5iZS5mYWxzZTtcclxufSk7XHJcblxyXG5UaGVuKCfQotGA0LDQvdC30LDQutGG0LjRjyDQvtGC0LzQtdC90LXQvdCwINGBINC+0YjQuNCx0LrQvtC5IHtzdHJpbmd9JywgZnVuY3Rpb24gKGVycm9yTWVzc2FnZSkge1xyXG4gIGV4cGVjdCh0aGlzLmxhc3RFcnJvcikudG8ubm90LmJlLnVuZGVmaW5lZDtcclxuICBcclxuICAvLyDQn9GA0L7QstC10YDRj9C10Lwg0YDQsNC30L3Ri9C1INGE0L7RgNC80LDRgtGLINC+0YjQuNCx0L7QulxyXG4gIGNvbnN0IGFjdHVhbEVycm9yID0gdGhpcy5sYXN0RXJyb3IubWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xyXG4gIGNvbnN0IGV4cGVjdGVkRXJyb3IgPSBlcnJvck1lc3NhZ2UudG9Mb3dlckNhc2UoKTtcclxuICBcclxuICBpZiAoIWFjdHVhbEVycm9yLmluY2x1ZGVzKGV4cGVjdGVkRXJyb3IpKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGVycm9yIFwiJHtlcnJvck1lc3NhZ2V9XCIgYnV0IGdvdCBcIiR7dGhpcy5sYXN0RXJyb3IubWVzc2FnZX1cImApO1xyXG4gIH1cclxufSk7XHJcbi8vINCY0YHQv9GA0LDQstC70LXQvdC90YvQtSDRiNCw0LPQuFxyXG5UaGVuKCfRg9GB0L/QtdGI0L3QvicsIGZ1bmN0aW9uICgpIHtcclxuICBleHBlY3QodGhpcy5sYXN0RXJyb3IpLnRvLmJlLm9uZU9mKFtudWxsLCB1bmRlZmluZWRdKTtcclxufSk7XHJcblxyXG5UaGVuKCfQvtGI0LjQsdC60LAnLCBmdW5jdGlvbiAoKSB7XHJcbiAgZXhwZWN0KHRoaXMubGFzdEVycm9yKS50by5ub3QuYmUub25lT2YoW251bGwsIHVuZGVmaW5lZF0pO1xyXG59KTtcclxuXHJcbi8vINCe0LHQvdC+0LLQuNGC0Ywg0YjQsNCzINC/0YDQvtCy0LXRgNC60Lgg0YHQvtC+0LHRidC10L3QuNGPINC+0LEg0L7RiNC40LHQutC1XHJcblRoZW4oJ9GB0L7QvtCx0YnQtdC90LjQtSDQvtCxINC+0YjQuNCx0LrQtSDRgdC+0LTQtdGA0LbQuNGCIHtzdHJpbmd9JywgZnVuY3Rpb24gKGVycm9yTWVzc2FnZSkge1xyXG4gIGlmIChlcnJvck1lc3NhZ2UgPT09ICcnKSB7XHJcbiAgICAvLyDQlNC70Y8g0L/Rg9GB0YLQvtCz0L4g0YHQvtC+0LHRidC10L3QuNGPIC0g0L7RiNC40LHQutC4INC90LUg0LTQvtC70LbQvdC+INCx0YvRgtGMXHJcbiAgICBleHBlY3QodGhpcy5sYXN0RXJyb3IpLnRvLmJlLm9uZU9mKFtudWxsLCB1bmRlZmluZWRdKTtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8g0JTQu9GPINC90LXQv9GD0YHRgtC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y8gLSDQtNC+0LvQttC90LAg0LHRi9GC0Ywg0L7RiNC40LHQutCwXHJcbiAgICBleHBlY3QodGhpcy5sYXN0RXJyb3IpLnRvLm5vdC5iZS5vbmVPZihbbnVsbCwgdW5kZWZpbmVkXSk7XHJcbiAgICBleHBlY3QodGhpcy5sYXN0RXJyb3IubWVzc2FnZSkudG8uaW5jbHVkZShlcnJvck1lc3NhZ2UpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyDQlNC+0LHQsNCy0LjRgtGMINGN0YLQvtGCINGI0LDQsyDQvtCx0YDQsNGC0L3QvlxyXG5UaGVuKCfQodC+0LHRi9GC0LjQtSBTdGFrZWQg0Y3QvNC40YLQuNGA0YPQtdGC0YHRjyDRgSDQv9Cw0YDQsNC80LXRgtGA0LDQvNC4IFxcXFwoYWxpY2UsIHtpbnR9KScsIGFzeW5jIGZ1bmN0aW9uIChhbW91bnQpIHtcclxuICBjb25zdCBhbW91bnRXZWkgPSBldGhlcnMucGFyc2VFdGhlcihhbW91bnQudG9TdHJpbmcoKSk7XHJcbiAgY29uc3QgcmVjZWlwdCA9IGF3YWl0IHRoaXMubGFzdFR4LndhaXQoKTtcclxuICBcclxuICBsZXQgZXZlbnRGb3VuZCA9IGZhbHNlO1xyXG4gIGZvciAoY29uc3QgbG9nIG9mIHJlY2VpcHQubG9ncykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZXZlbnQgPSB0aGlzLmNvbnRyYWN0LmludGVyZmFjZS5wYXJzZUxvZyhsb2cpO1xyXG4gICAgICBpZiAoZXZlbnQubmFtZSA9PT0gXCJTdGFrZWRcIiAmJiBcclxuICAgICAgICAgIGV2ZW50LmFyZ3MudXNlciA9PT0gdGhpcy5hbGljZS5hZGRyZXNzICYmIFxyXG4gICAgICAgICAgZXZlbnQuYXJncy5hbW91bnQgPT0gYW1vdW50V2VpKSB7XHJcbiAgICAgICAgZXZlbnRGb3VuZCA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8g0JjQs9C90L7RgNC40YDRg9C10Lwg0L3QtdGA0LXQu9C10LLQsNC90YLQvdGL0LUg0LvQvtCz0LhcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgaWYgKCFldmVudEZvdW5kKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV2ZW50IFN0YWtlZCB3aXRoIHBhcmFtZXRlcnMgKGFsaWNlLCAke2Ftb3VudH0pIG5vdCBmb3VuZGApO1xyXG4gIH1cclxufSk7XHJcblxyXG5cclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU07RUFBRUEsS0FBSztFQUFFQyxJQUFJO0VBQUVDLElBQUk7RUFBRUM7QUFBTyxDQUFDLEdBQUdDLE9BQU8s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","map":{"version":3,"names":["Given","When","Then","Before","require","expect","ethers","fs","path","nonceManager","provider","JsonRpcProvider","accounts","listAccounts","privateKeys","signers","i","length","wallet","Wallet","push","address","getTransactionCount","admin","alice","bob","carol","dave","contract","lastTx","lastError","tags","artifactPath","join","process","cwd","artifact","JSON","parse","readFileSync","bytecode","object","nonce","tx","sendTransaction","data","gasLimit","receipt","wait","contractAddress","Contract","abi","STUDENT_ROLE","keccak256","toUtf8Bytes","PROFESSOR_ROLE","ADMIN_ROLE","INVESTOR_ROLE","signer","methodName","args","connect","paused","to","be","false","userName","roleName","user","toLowerCase","role","Error","minBalance","minBalanceWei","parseEther","String","amount","userBalance","balanceOf","true","amountWei","toString","error","stakeBalance","getStake","equal","eventFound","log","logs","event","interface","parseLog","name","e","isPaused","errorMessage","not","undefined","actualError","message","expectedError","includes","oneOf","include"],"sourceRoot":"/home/serge/blockchain-lab2/lab3/features/step_definitions/","sources":["educhain_staking_steps.js"],"sourcesContent":["const { Given, When, Then, Before } = require('@cucumber/cucumber');\r\nconst { expect } = require('chai');\r\nconst { ethers } = require(\"ethers\");\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\n// Глобальный объект для отслеживания nonce\r\nconst nonceManager = {};\r\n\r\nBefore(async function () {\r\n  // Инициализация провайдера\r\n  this.provider = new ethers.JsonRpcProvider(\"http://localhost:8545\");\r\n  \r\n  // Получаем аккаунты\r\n  this.accounts = await this.provider.listAccounts();\r\n  \r\n  // Приватные ключи для Anvil\r\n  const privateKeys = [\r\n    \"0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80\", // admin\r\n    \"0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d\", // alice\r\n    \"0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a\", // bob\r\n    \"0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6\", // carol\r\n    \"0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a\"  // dave\r\n  ];\r\n  \r\n  this.signers = [];\r\n  for (let i = 0; i < privateKeys.length; i++) {\r\n    const wallet = new ethers.Wallet(privateKeys[i], this.provider);\r\n    this.signers.push(wallet);\r\n    \r\n    // Инициализируем nonce для каждого аккаунта\r\n    nonceManager[wallet.address] = await this.provider.getTransactionCount(wallet.address, 'latest');\r\n  }\r\n  \r\n  // Сохраняем пользователей по именам\r\n  this.admin = this.signers[0];\r\n  this.alice = this.signers[1];\r\n  this.bob = this.signers[2];\r\n  this.carol = this.signers[3];\r\n  this.dave = this.signers[4];\r\n  \r\n  // Сброс состояния\r\n  this.contract = null;\r\n  this.lastTx = null;\r\n  this.lastError = null;\r\n});\r\n\r\nBefore({ tags: \"@requires_contract\" }, async function () {\r\n  const artifactPath = path.join(process.cwd(), 'out', 'EDUToken.sol', 'EDUToken.json');\r\n  const artifact = JSON.parse(fs.readFileSync(artifactPath, 'utf8'));\r\n  const bytecode = artifact.bytecode.object || artifact.bytecode;\r\n  \r\n  // Используем nonceManager для админа\r\n  const nonce = nonceManager[this.admin.address];\r\n  \r\n  const tx = await this.admin.sendTransaction({\r\n    data: bytecode,\r\n    gasLimit: 10_000_000,\r\n    nonce\r\n  });\r\n  \r\n  const receipt = await tx.wait();\r\n  this.contractAddress = receipt.contractAddress;\r\n  nonceManager[this.admin.address]++; // Увеличиваем nonce\r\n  \r\n  this.contract = new ethers.Contract(\r\n    this.contractAddress,\r\n    artifact.abi,\r\n    this.admin\r\n  );\r\n  \r\n  // Инициализация хешей ролей\r\n  this.STUDENT_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"STUDENT_ROLE\"));\r\n  this.PROFESSOR_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"PROFESSOR_ROLE\"));\r\n  this.ADMIN_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"DEFAULT_ADMIN_ROLE\"));\r\n  this.INVESTOR_ROLE = ethers.keccak256(ethers.toUtf8Bytes(\"INVESTOR_ROLE\"));\r\n});\r\n\r\n// Общий метод для отправки транзакций с управлением nonce\r\nasync function sendTransaction(signer, contract, methodName, args) {\r\n  const address = signer.address;\r\n  const nonce = nonceManager[address];\r\n  \r\n  let tx;\r\n  if (contract) {\r\n    tx = await contract.connect(signer)[methodName](...args, { nonce });\r\n  } else {\r\n    // Для простых транзакций (например, развертывание)\r\n    tx = await signer.sendTransaction({ ...args, nonce });\r\n  }\r\n  \r\n  await tx.wait();\r\n  nonceManager[address]++; // Увеличиваем nonce после успешной транзакции\r\n  return tx;\r\n}\r\n\r\nGiven('Контракт не находится в состоянии паузы', async function () {\r\n  expect(await this.contract.paused()).to.be.false;\r\n});\r\n\r\nGiven('Пользователь {string} имеет роль {string}', async function (userName, roleName) {\r\n  const user = this[userName.toLowerCase()];\r\n  let role;\r\n  \r\n  switch(roleName) {\r\n    case 'Student': role = this.STUDENT_ROLE; break;\r\n    case 'Professor': role = this.PROFESSOR_ROLE; break;\r\n    case 'Admin': role = this.ADMIN_ROLE; break;\r\n    case 'Investor': role = this.INVESTOR_ROLE; break;\r\n    default: throw new Error(`Unknown role: ${roleName}`);\r\n  }\r\n  \r\n  await sendTransaction(\r\n    this.admin,\r\n    this.contract,\r\n    'grantRole',\r\n    [role, user.address]\r\n  );\r\n});\r\n\r\n// Обновить шаги, связанные с балансом\r\nGiven('Кошелек {string} имеет баланс ≥ {int} EDU', async function (userName, minBalance) {\r\n  const user = this[userName.toLowerCase()];\r\n  const minBalanceWei = ethers.parseEther(String(minBalance));\r\n  const amount = minBalanceWei + ethers.parseEther(\"1\");\r\n  \r\n  await sendTransaction(\r\n    this.admin,\r\n    this.contract,\r\n    'mint',\r\n    [user.address, amount]\r\n  );\r\n  \r\n  const userBalance = await this.contract.balanceOf(user.address);\r\n  expect(userBalance >= minBalanceWei).to.be.true;\r\n});\r\n\r\nGiven('Администратор приостановил контракт', async function () {\r\n  await sendTransaction(\r\n    this.admin,\r\n    this.contract,\r\n    'setPaused',\r\n    [true]\r\n  );\r\n  expect(await this.contract.paused()).to.be.true;\r\n});\r\n\r\n// В шаге When добавить сброс ошибки\r\nWhen('Пользователь {string} вызывает метод stake\\\\({int})', async function (userName, amount) {\r\n  const user = this[userName.toLowerCase()];\r\n  this.lastError = null; // Сбрасываем ошибку\r\n  const amountWei = ethers.parseEther(amount.toString());\r\n  \r\n  try {\r\n    this.lastTx = await sendTransaction(\r\n      user,\r\n      this.contract,\r\n      'stake',\r\n      [amountWei]\r\n    );\r\n  } catch (error) {\r\n    this.lastError = error;\r\n  }\r\n});\r\n\r\nThen('Баланс стейкинга {string} увеличивается на {int} EDU', async function (userName, amount) {\r\n  const user = this[userName.toLowerCase()];\r\n  const stakeBalance = await this.contract.getStake(user.address);\r\n  const amountWei = ethers.parseEther(amount.toString());\r\n  expect(stakeBalance).to.equal(amountWei);\r\n});\r\n\r\nThen('Баланс стейкинга {string} не изменяется', async function (userName) {\r\n  const user = this[userName.toLowerCase()];\r\n  const stakeBalance = await this.contract.getStake(user.address);\r\n  expect(stakeBalance).to.equal(0n); // Используем BigInt литерал 0n\r\n});\r\n\r\nThen('Событие Staked эмитируется с параметрами \\\\({string}, {int})', async function (userName, amount) {\r\n  const user = this[userName.toLowerCase()];\r\n  const amountWei = ethers.parseEther(amount.toString());\r\n  const receipt = await this.lastTx.wait();\r\n  \r\n  let eventFound = false;\r\n  for (const log of receipt.logs) {\r\n    try {\r\n      const event = this.contract.interface.parseLog(log);\r\n      if (event.name === \"Staked\" && \r\n          event.args.user === user.address && \r\n          event.args.amount == amountWei) {\r\n        eventFound = true;\r\n        break;\r\n      }\r\n    } catch (e) {\r\n      // Игнорируем нерелевантные логи\r\n    }\r\n  }\r\n  \r\n  if (!eventFound) {\r\n    throw new Error(`Event Staked with parameters (${userName}, ${amount}) not found`);\r\n  }\r\n});\r\n\r\nGiven('Контракт активен', async function () {\r\n  const isPaused = await this.contract.paused();\r\n  \r\n  if (isPaused) {\r\n    await sendTransaction(\r\n      this.admin,\r\n      this.contract,\r\n      'setPaused',\r\n      [false]\r\n    );\r\n  }\r\n  \r\n  expect(await this.contract.paused()).to.be.false;\r\n});\r\n\r\nThen('Транзакция отменена с ошибкой {string}', function (errorMessage) {\r\n  expect(this.lastError).to.not.be.undefined;\r\n  \r\n  // Проверяем разные форматы ошибок\r\n  const actualError = this.lastError.message.toLowerCase();\r\n  const expectedError = errorMessage.toLowerCase();\r\n  \r\n  if (!actualError.includes(expectedError)) {\r\n    throw new Error(`Expected error \"${errorMessage}\" but got \"${this.lastError.message}\"`);\r\n  }\r\n});\r\n// Исправленные шаги\r\nThen('успешно', function () {\r\n  expect(this.lastError).to.be.oneOf([null, undefined]);\r\n});\r\n\r\nThen('ошибка', function () {\r\n  expect(this.lastError).to.not.be.oneOf([null, undefined]);\r\n});\r\n\r\n// Обновить шаг проверки сообщения об ошибке\r\nThen('сообщение об ошибке содержит {string}', function (errorMessage) {\r\n  if (errorMessage === '') {\r\n    // Для пустого сообщения - ошибки не должно быть\r\n    expect(this.lastError).to.be.oneOf([null, undefined]);\r\n  } else {\r\n    // Для непустого сообщения - должна быть ошибка\r\n    expect(this.lastError).to.not.be.oneOf([null, undefined]);\r\n    expect(this.lastError.message).to.include(errorMessage);\r\n  }\r\n});\r\n\r\n// Добавить этот шаг обратно\r\nThen('Событие Staked эмитируется с параметрами \\\\(alice, {int})', async function (amount) {\r\n  const amountWei = ethers.parseEther(amount.toString());\r\n  const receipt = await this.lastTx.wait();\r\n  \r\n  let eventFound = false;\r\n  for (const log of receipt.logs) {\r\n    try {\r\n      const event = this.contract.interface.parseLog(log);\r\n      if (event.name === \"Staked\" && \r\n          event.args.user === this.alice.address && \r\n          event.args.amount == amountWei) {\r\n        eventFound = true;\r\n        break;\r\n      }\r\n    } catch (e) {\r\n      // Игнорируем нерелевантные логи\r\n    }\r\n  }\r\n  \r\n  if (!eventFound) {\r\n    throw new Error(`Event Staked with parameters (alice, ${amount}) not found`);\r\n  }\r\n});\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}},"mtime":1752939735654}}